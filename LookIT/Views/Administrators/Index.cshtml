@using Microsoft.AspNetCore.Identity
@using LookIT.Models
@inject UserManager<ApplicationUser> UserManager

@{
    ViewBag.Title = "Gestionare Utilizatori";
}

<div class="py-5">
    <div class="container">
        @* --- HEADER PAGINA --- *@
        <div class="text-center mb-5">
            <h2 class="fw-bold lookit-title">Control Utilizatori</h2>
            <p class="text-muted">Administrează membrii și permisiunile platformei</p>
        </div>

        @if (ViewBag.message != null)
        {
            <div class="row justify-content-center mb-4">
                <div class="col-md-8 col-lg-6">
                    <div class="alert shadow-sm text-center py-2 px-4" role="alert">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <span class="fw-bold">@ViewBag.message</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </div>
            </div>
        }

        @* --- LISTA UTILIZATORI --- *@
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                @foreach (var user in ViewBag.Users)
                {
                    <div class="card mb-3 border-0 shadow-sm rounded-4 overflow-hidden">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center mb-3">
                                
                                <div class="rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                                     style="width: 50px; height: 50px; background-color: #FDF2F7; color: #B13079;">
                                    <i class="bi bi-person-fill" style="font-size: 1.5rem;"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-0 fw-bold text-dark">@user.UserName</h6>
                                    <small class="text-muted" style="font-size: 0.75rem;">ID: @user.Id</small>
                                </div>
                            </div>

                            @* Detalii utilizator *@
                            <div class="p-2 mb-3 rounded-3 bg-light">
                                <p class="mb-0 text-dark small">
                                    <strong><i class="bi bi-envelope-fill me-2 lookit-title"></i>Email:</strong> @user.Email
                                </p>
                            </div>

                            @* Butoane *@
                            <div class="d-flex flex-wrap gap-2 pt-3 border-top" style="border-color: rgba(177, 48, 121, 0.1) !important;">

                                @* Buton Upgrade Admin *@
                                @if (!await UserManager.IsInRoleAsync(user, "Administrator"))
                                {
                                    <form asp-controller="Administrators" asp-action="PromoteToAdms" method="post" class="flex-fill">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@user.Id" />
                                        <button type="submit" class="btn btn-lookit-action-vibrant w-100 justify-content-center"
                                                onclick="return confirm('Sigur doriți să acordați rolul de Administrator?');">
                                            <i class="bi bi-shield-plus"></i> Upgrade
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <div class="flex-fill text-center py-2 rounded-pill shadow-sm" style="background-color: #FDF2F7; border: 1px solid #B13079;">
                                        <span class="fw-bold lookit-title small">
                                            <i class="bi bi-patch-check-fill"></i> Administrator
                                        </span>
                                    </div>
                                }

                                @* Buton Profil  *@
                                <a asp-controller="Profile" asp-action="Details" asp-route-userId="@user.Id"
                                   class="btn btn-discard flex-fill d-flex align-items-center justify-content-center">
                                    <i class="bi bi-eye me-1"></i> Profil
                                </a>

                                @* Buton Stergere  *@
                                <form asp-controller="Administrators" asp-action="DeleteUser" method="post" class="flex-fill">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@user.Id" />
                                    <button type="submit" class="btn btn-discard w-100 d-flex align-items-center justify-content-center"
                                            style="color: #dc3545 !important;"
                                            onclick="return confirm('ATENȚIE! Ștergerea utilizatorului este ireversibilă.');">
                                        <i class="bi bi-trash3 me-1"></i> Șterge
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
  
    .btn-lookit-action-vibrant {
        padding: 8px 16px !important;
    }
</style>