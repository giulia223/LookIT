@using Microsoft.AspNetCore.Identity
@using LookIT.Models
@inject UserManager<ApplicationUser> UserManager

@{
    ViewBag.Title = "Gestionare Utilizatori";
}

<div class="py-5">
    <div class="container">
        @* --- HEADER PAGINA --- *@
        <div class="text-center mb-5">
            <h2 class="fw-bold text-black">Control Utilizatori</h2>
            <p class="text-muted">Administrează membrii și permisiunile platformei</p>
            <hr class="mx-auto" style="width: 60px; border-top: 3px solid #B13079; opacity: 1;">
        </div>

        @if (ViewBag.message != null)
        {
            <div class="row justify-content-center mb-4">
                <div class="col-md-8 col-lg-6">
                    <div class="alert shadow-sm text-center py-2 px-4 border-0" role="alert"
                         style="background-color: #E7F0FF; color: #0D6EFD; border-radius: 12px;">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <span class="fw-bold">@ViewBag.message</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </div>
            </div>
        }

        @* --- LISTA UTILIZATORI --- *@
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                @foreach (var user in ViewBag.Users)
                {
                    <div class="card mb-3 border-0 shadow-sm rounded-4 overflow-hidden user-admin-card" style="background-color: #ffffff;">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="d-flex align-items-center">
                                    @* Avatar Placeholder cu Gri/Albastru *@
                                    <div class="rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                                         style="width: 55px; height: 55px; background-color: #F0F2F5; color: #65676B;">
                                        <i class="bi bi-person-fill" style="font-size: 1.8rem;"></i>
                                    </div>
                                    <div class="ms-3">
                                        <h5 class="mb-0 fw-bold text-black">@user.UserName</h5>
                                        <code class="text-muted small" style="font-size: 0.7rem;">ID: @user.Id</code>
                                    </div>
                                </div>

                                @* Badge Status *@
                                @if (await UserManager.IsInRoleAsync(user, "Administrator"))
                                {
                                    <span class="badge rounded-pill px-3 py-2" style="background-color: #FDF2F7; color: #B13079; border: 1px solid #B13079;">
                                        <i class="bi bi-patch-check-fill me-1"></i> Administrator
                                    </span>
                                }
                            </div>

                            @* Detalii utilizator - Gri Neutru *@
                            <div class="p-3 mb-3 rounded-4" style="background-color: #F8F9FA; border: 1px solid #E4E6EB;">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <small class="text-muted d-block">Adresă Email</small>
                                        <span class="text-black fw-medium">@user.Email</span>
                                    </div>
                                    <div class="col-sm-6 mt-2 mt-sm-0 text-sm-end">
                                        <small class="text-muted d-block">Rol Sistem</small>
                                        <span class="text-black">@(await UserManager.IsInRoleAsync(user, "Administrator") ? "Admin" : "Membru")</span>
                                    </div>
                                </div>
                            </div>

                            @* Butoane Acțiuni *@
                            <div class="d-flex flex-wrap gap-2 pt-3">

                                @if (!await UserManager.IsInRoleAsync(user, "Administrator"))
                                {
                                    <form asp-controller="Administrators" asp-action="PromoteToAdms" method="post" class="flex-fill">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@user.Id" />
                                        <button type="submit" class="btn btn-promote w-100"
                                                onclick="return confirm('Sigur doriți să acordați rolul de Administrator?');">
                                            <i class="bi bi-shield-plus me-1"></i> Upgrade Admin
                                        </button>
                                    </form>
                                }

                                <a asp-controller="Profile" asp-action="Details" asp-route-userId="@user.Id"
                                   class="btn btn-view-profile flex-fill">
                                    <i class="bi bi-eye me-1"></i> Vezi Profil
                                </a>

                                <form asp-controller="Administrators" asp-action="DeleteUser" method="post" class="flex-fill">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@user.Id" />
                                    <button type="submit" class="btn btn-delete-user w-100"
                                            onclick="return confirm('ATENȚIE! Ștergerea este ireversibilă.');">
                                        <i class="bi bi-trash3 me-1"></i> Șterge
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
    .text-black {
        color: #1c1e21 !important;
    }

    .user-admin-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .user-admin-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.06) !important;
        }

    /* Buton Upgrade - Albastru/Magenta */
    .btn-promote {
        background-color: #E7F0FF;
        color: #0D6EFD;
        border: none;
        padding: 10px 15px;
        border-radius: 50rem;
        font-weight: 700;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

        .btn-promote:hover {
            background-color: #0D6EFD;
            color: white;
        }

    /* Buton Profil - Gri */
    .btn-view-profile {
        background-color: #F0F2F5;
        color: #4b4f56;
        border: none;
        padding: 10px 15px;
        border-radius: 50rem;
        font-weight: 700;
        font-size: 0.85rem;
        text-decoration: none;
        text-align: center;
        transition: all 0.2s ease;
    }

        .btn-view-profile:hover {
            background-color: #E4E6EB;
            color: #1c1e21;
        }

    /* Buton Ștergere - Roșu Soft */
    .btn-delete-user {
        background-color: #FFEBEE;
        color: #D32F2F;
        border: none;
        padding: 10px 15px;
        border-radius: 50rem;
        font-weight: 700;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

        .btn-delete-user:hover {
            background-color: #D32F2F;
            color: white;
        }
</style>