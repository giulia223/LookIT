@model List<LookIT.Models.Post>

@{
    ViewData["Title"] = "Aprecieri";
}

<div class="container py-4">

    @* HEADER *@
    <div class="d-flex align-items-center mb-4 px-2">
        <h4 class="fw-bold mb-0 me-2">Postări apreciate</h4>
        <i class="bi bi-heart-fill text-danger"></i>
        <small class="text-muted ms-auto">@Model.Count aprecieri</small>
    </div>

    @if (Model.Any())
    {
        <div class="row g-1 mb-4">
            @foreach (var post in Model)
            {
                <div class="col-4">
                    <a asp-controller="Posts" asp-action="Show" asp-route-id="@post.PostId" class="text-decoration-none user-select-none">

                        <div class="ratio ratio-1x1 border-0 rounded-0 overflow-hidden position-relative shadow-sm bg-light post-card-hover">

                            @* ========================================================== *@
                            @* 1. ICONITE TIP (PERMANENTE - STANGA SUS)                   *@
                            @* ========================================================== *@
                            <div class="position-absolute" style="top: 11px; left: 10px; z-index: 20;">
                                @if (!string.IsNullOrEmpty(post.VideoUrl))
                                {
                                    <i class="bi bi-camera-reels-fill text-white fs-5 drop-shadow-icon"></i>
                                }
                                else if (!string.IsNullOrEmpty(post.ImageUrl))
                                {
                                    <i class="bi bi-image-fill text-white fs-5 drop-shadow-icon"></i>
                                }
                                else
                                {
                                    <i class="bi bi-file-text-fill text-white fs-5 drop-shadow-icon"></i>
                                }
                            </div>

                            @* ========================================================== *@
                            @* 2. OVERLAY HOVER (AUTOR - DREAPTA SUS)                     *@
                            @* ========================================================== *@
                            <div class="hover-overlay p-3">
                                @* Am marit padding-ul la p-3 *@

                                @* Autorul va sta in DREAPTA sus *@
                                <div class="d-flex align-items-center justify-content-end w-100 text-truncate">

                                    @* Numele - Scos 'small', adaugat font-size mai mare *@
                                    <span class="text-white me-3 fw-bold text-truncate text-shadow text-end" style="font-size: 1rem;">
                                        @post.Author.FullName
                                    </span>

                                    @* Poza - Marita la 32px *@
                                    <img src="@post.Author.ProfilePictureUrl"
                                         class="rounded-circle border border-1 border-white"
                                         alt="User"
                                         style="width: 30px; height: 30px; object-fit: cover; flex-shrink: 0;">
                                </div>
                            </div>

                            @* ========================================================== *@
                            @* 3. CONTINUTUL POSTARII                                     *@
                            @* ========================================================== *@

                            @if (!string.IsNullOrEmpty(post.ImageUrl))
                            {
                                <img src="@post.ImageUrl" class="w-100 h-100" style="object-fit: cover;" alt="Post Image">
                            }
                            else if (!string.IsNullOrEmpty(post.VideoUrl))
                            {
                                <video class="w-100 h-100" style="object-fit: cover;" muted>
                                    <source src="@post.VideoUrl" type="video/mp4">
                                </video>
                            }
                            else
                            {
                                @* TEXT *@
                                var rawHtml = post.TextContent ?? "";
                                var plainText = System.Text.RegularExpressions.Regex.Replace(rawHtml, "<.*?>", " ").Trim();
                                var previewText = plainText.Length > 70 ? plainText.Substring(0, 70) + "..." : plainText;

                                <div class="d-flex flex-column align-items-center justify-content-center h-100 p-3 text-center bg-white">
                                    <i class="bi bi-quote fs-1 text-muted opacity-25 mb-1"></i>
                                    <small class="fw-bold text-dark text-break fst-italic pe-2 ps-2" style="font-family: 'Georgia', serif; line-height: 1.3;">
                                        @previewText
                                    </small>
                                </div>
                            }

                        </div>
                    </a>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5 mt-5">
            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                <i class="bi bi-heart text-muted opacity-50" style="font-size: 2.5rem;"></i>
            </div>
            <h5 class="fw-bold text-dark">Nu ai aprecieri</h5>
            <p class="text-muted small">Apasă pe inimioară la postările care îți plac.</p>
            <a asp-controller="Posts" asp-action="Index" class="btn btn-primary btn-sm rounded-pill px-4 fw-bold">
                Explorează
            </a>
        </div>
    }
</div>

<style>
    /* Overlay-ul negru pentru hover */
    .hover-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: flex-start; /* Aliniere verticala: Sus */
        justify-content: flex-end; /* Aliniere orizontala: DREAPTA */

        background: rgba(0, 0, 0, 0.4);
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        z-index: 10;
    }

    .post-card-hover:hover .hover-overlay {
        opacity: 1;
        cursor: pointer;
    }

    /* Iconitele permanente */
    .drop-shadow-icon {
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.8));
        /* FIX: Fortam culoarea alba si tranzitia lina */
        color: #fff !important;
    }

    .text-shadow {
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    .font-georgia {
        font-family: 'Georgia', serif;
        line-height: 1.3;
    }

    .post-card-hover {
        transform: translateZ(0);
    }
</style>