@model LookIT.Models.Collection

@{
    ViewData["Title"] = Model.Name;
}

<div class="container mt-4 mb-5">

    @* ================================================================================= *@
    @* 1. HEADER MODERN (Cu iconiță și butoane noi)                                     *@
    @* ================================================================================= *@
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-end mb-4 border-bottom pb-4 gap-3">

        @* Titlu și Iconiță *@
        <div>
            <div class="d-flex align-items-center gap-3">
                @* Iconita galbena *@
                <div class="bg-warning bg-opacity-10 p-2 rounded-3 text-warning d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                    <i class="bi bi-bookmark-fill fs-3"></i>
                </div>

                <div>
                    <h1 class="fw-bold mb-0 display-6" style="font-size: 2rem;">@Model.Name</h1>
                    <p class="text-muted mb-0 small text-uppercase fw-bold tracking-wide">
                        @Model.PostCollections.Count @(Model.PostCollections.Count == 1 ? "postare" : "postări")
                    </p>
                </div>
            </div>
        </div>

        @* Butoane Actiuni (Stil Modern Soft UI) *@
        @if ((Model.UserId == ViewBag.UserCurent || ViewBag.EsteAdministrator) && Model.Name != "All Posts")
        {
            <div class="d-flex gap-2">
                <a asp-action="Edit" asp-controller="Collections" asp-route-Id="@Model.CollectionId"
                   class="btn btn-soft-secondary rounded-pill px-4 fw-bold">
                    <i class="bi bi-pencil-square me-2"></i>Editează
                </a>

                <form method="post" asp-controller="Collections" asp-action="Delete" asp-route-Id="@Model.CollectionId">
                    <button type="submit" class="btn btn-soft-danger rounded-pill px-4 fw-bold"
                            onclick="return confirm('Ești sigur că vrei să ștergi colecția? Postările vor rămâne salvate, dar colecția va dispărea.')">
                        <i class="bi bi-trash3 me-2"></i>Șterge
                    </button>
                </form>
            </div>
        }
    </div>

    @* ================================================================================= *@
    @* 2. GRID POSTĂRI (Exact codul tău original)                                       *@
    @* ================================================================================= *@
    @if (Model.PostCollections.Count > 0)
    {
        <div class="row g-1">
            @foreach (var pc in Model.PostCollections)
            {
                @if (pc.Post != null)
                {
                    <div class="col-4">

                        @* CARD PRINCIPAL *@
                        <div class="ratio ratio-1x1 border-0 rounded-0 overflow-hidden position-relative shadow-sm bg-light post-card-hover">

                            @* HEADER CARD (SUS) *@
                            <div class="position-absolute top-0 start-0 w-100 p-2 d-flex justify-content-between align-items-start" style="z-index: 30; pointer-events: none;">

                                @* ELEMENT DREAPTA: Iconita Tip *@
                                <div>
                                    @if (!string.IsNullOrEmpty(pc.Post.VideoUrl))
                                    {
                                        <i class="bi bi-camera-reels-fill text-white fs-5 drop-shadow-icon"></i>
                                    }
                                    else if (!string.IsNullOrEmpty(pc.Post.ImageUrl))
                                    {
                                        <i class="bi bi-image-fill text-white fs-5 drop-shadow-icon"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-file-text-fill text-white fs-5 drop-shadow-icon"></i>
                                    }
                                </div>

                                @* ELEMENT STANGA: Buton Stergere *@
                                <div style="pointer-events: auto;">
                                    @if ((Model.UserId == ViewBag.UserCurent || ViewBag.EsteAdministrator))
                                    {
                                        <form method="post" asp-controller="Posts" asp-action="RemoveFromCollection">
                                            <input type="hidden" name="postId" value="@pc.PostId" />
                                            <input type="hidden" name="collectionId" value="@Model.CollectionId" />

                                            <button type="submit" class="btn btn-sm btn-dark bg-opacity-25 border-0 rounded-circle text-white d-flex align-items-center justify-content-center hover-danger"
                                                    style="width: 30px; height: 30px; backdrop-filter: blur(2px);"
                                                    title="Elimină din colecție"
                                                    onclick="return confirm('Elimini postarea din colecție?');">
                                                <i class="bi bi-x-lg" style="font-size: 0.8rem;"></i>
                                            </button>
                                        </form>
                                    }
                                </div>
                            </div>

                            @* LINK + CONTINUT *@
                            <a href="/Posts/Show/@pc.PostId" class="text-decoration-none d-block w-100 h-100 user-select-none">

                                @* OVERLAY LA HOVER (JOS) *@
                                <div class="hover-overlay p-3">
                                    <div class="d-flex align-items-end justify-content-between w-100 h-100">
                                        @* Autor *@
                                        <div class="d-flex align-items-center text-truncate" style="max-width: 60%;">
                                            <img src="@(pc.Post.Author?.ProfilePictureUrl)"
                                                 class="rounded-circle border border-1 border-white"
                                                 alt="User"
                                                 style="width: 30px; height: 30px; object-fit: cover; flex-shrink: 0;">
                                            <span class="text-white ms-2 fw-bold text-truncate text-shadow" style="font-size: 1rem;">
                                                @(pc.Post.Author?.FullName)
                                            </span>
                                        </div>
                                        @* Data *@
                                        <div class="text-white text-end text-shadow" style="max-width: 40%;">
                                            <div style="font-size: 0.65rem; opacity: 0.8; line-height: 1;">Adăugat la:</div>
                                            <div class="fw-bold" style="font-size: 0.8rem;">
                                                @pc.AddedDate.ToString("dd MMM")
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                @* VISUAL CONTENT *@
                                @if (!string.IsNullOrEmpty(pc.Post.ImageUrl))
                                {
                                    <img src="@pc.Post.ImageUrl" class="w-100 h-100" style="object-fit: cover;" alt="Post Image">
                                }
                                else if (!string.IsNullOrEmpty(pc.Post.VideoUrl))
                                {
                                    <video class="w-100 h-100" style="object-fit: cover;" muted>
                                        <source src="@pc.Post.VideoUrl" type="video/mp4">
                                    </video>
                                }
                                else
                                {
                                    <div class="d-flex flex-column align-items-center justify-content-center h-100 p-3 text-center bg-white">
                                        <i class="bi bi-quote fs-1 text-muted opacity-25 mb-1"></i>
                                        <small class="fw-bold text-dark text-break fst-italic font-georgia">
                                            @{
                                                var rawHtml = pc.Post.TextContent ?? "";
                                                var plainText = System.Text.RegularExpressions.Regex.Replace(rawHtml, "<.*?>", " ").Trim();
                                                var previewText = plainText.Length > 60 ? plainText.Substring(0, 60) + "..." : plainText;
                                            }
                                            @previewText
                                        </small>
                                    </div>
                                }
                            </a>
                        </div>
                    </div>
                }
            }
        </div>
    }
    else
    {
        @* ================================================================================= *@
        @* 3. EMPTY STATE MODERN (Designul nou pentru colecție goală)                       *@
        @* ================================================================================= *@
        <div class="empty-state-container text-center py-5 mt-4 rounded-4 bg-light bg-opacity-50 border border-dashed">
            <div class="mb-4 d-inline-block position-relative">
                <div class="bg-white rounded-circle shadow-sm d-flex align-items-center justify-content-center"
                     style="width: 100px; height: 100px;">
                    <i class="bi bi-journal-bookmark text-primary opacity-75" style="font-size: 3rem;"></i>
                </div>
            </div>

            <h3 class="fw-bold text-dark mb-2">Colecția este goală</h3>
            <p class="text-muted mb-4" style="max-width: 400px; margin: 0 auto;">
                Încă nu ai adăugat nimic aici. Explorează feed-ul pentru a salva postări.
            </p>

            <a href="/" class="btn btn-primary rounded-pill px-5 py-2 fw-bold shadow-sm transition-transform">
                Explorează Feed-ul
            </a>
        </div>
    }
</div>

@* STILURI CSS *@
<style>
    /* Stiluri Generale */
    .tracking-wide {
        letter-spacing: 0.05em;
    }

    /* Butoane Soft UI (Pentru Header) */
    .btn-soft-secondary {
        background-color: #f1f5f9;
        color: #475569;
        border: 1px solid transparent;
        transition: all 0.2s ease;
    }

        .btn-soft-secondary:hover {
            background-color: #e2e8f0;
            color: #1e293b;
            transform: translateY(-1px);
        }

    .btn-soft-danger {
        background-color: #fef2f2;
        color: #dc2626;
        border: 1px solid transparent;
        transition: all 0.2s ease;
    }

        .btn-soft-danger:hover {
            background-color: #fee2e2;
            color: #b91c1c;
            transform: translateY(-1px);
        }

    /* Stiluri Originale Grid (Păstrate) */
    .post-card-hover {
        transform: translateZ(0);
    }

    .hover-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        z-index: 10;
    }

    .post-card-hover:hover .hover-overlay {
        opacity: 1;
    }

    .drop-shadow-icon {
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.8));
        color: #fff !important;
    }

    .text-shadow {
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    .font-georgia {
        font-family: 'Georgia', serif;
        line-height: 1.3;
    }

    .hover-danger {
        transition: all 0.2s ease;
    }

        .hover-danger:hover {
            background-color: #dc3545 !important;
            opacity: 1 !important;
            transform: scale(1.1);
        }

    /* Stiluri Empty State */
    .border-dashed {
        border-style: dashed !important;
        border-color: #cbd5e1 !important;
    }

    .transition-transform {
        transition: transform 0.2s;
    }

        .transition-transform:hover {
            transform: translateY(-2px);
        }
</style>